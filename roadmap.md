# RS-Agent 迭代计划（Roadmap）

后续功能与改进按本文件规划分阶段实施。**当某项已完成并写入 CHANGELOG 发版后，请从本文件中删除该项**（见文末维护说明）。

---

## 一、阶段划分

| 阶段 | 目标 | 建议周期 |
|------|------|----------|
| **Phase 1** | 可靠性 + 可维护性（P0） | 2–3 周 |
| **Phase 2** | 体验与稳定性（P1） | 2–3 周 |
| **Phase 3** | 产品化与扩展 | 按需多轮迭代 |

---

## 二、Phase 1：高优先级（P0）

**目标**：解决架构级问题，为后续迭代打基础。

Phase 1（P0）全部完成。

> P0-1（AgentPipeline 服务层）与 P0-2（会话持久化）已完成，见 CHANGELOG v0.2.0。
> P0-3（异步化 I/O）与 P0-4（API Key 认证）已完成，见 CHANGELOG v0.3.0。

---

## 三、Phase 2：中优先级（P1）

**目标**：提升体验、可维护性和鲁棒性。

| 序号 | 任务 | 依赖 | 产出/验收 |
|------|------|------|-----------|
| P1-1 | 意图路由升级 | 无 | 支持更多表述（如 LLM 意图分类或关键词+规则混合），降低误判 KB_QUERY/ORCH_FLOW |
| P1-2 | 前端组件拆分 | 无 | App.tsx 拆为 ChatPanel / MessageBubble / TracePanel / HistoryDrawer / InputArea 等，单文件控制在 200 行内 |
| P1-3 | Prompt 模板化 | 无 | llm_service 中 prompt 抽到 YAML/JSON 等模板文件，代码只做加载与变量替换 |
| P1-4 | 会话超时与清理 | P0-2 | 内存/库中会话带 TTL（如 2h），超时自动清理或归档；可配置 |
| P1-5 | LLM 调用增加重试 | 无（P0-3 更佳） | 使用 tenacity 或 httpx 重试，指数退避，最大重试 3 次，可配置 |
| P1-6 | 实现 redo 能力 | P0-2 | request_redo_partial / request_redo_full 真实执行重做（回退状态并重新生成对应部分/全文） |

**建议顺序**：P1-4、P1-5、P1-3 可先做；P1-1、P1-2 可并行；P1-6 依赖 P0-2。

---

## 四、Phase 3：后续迭代方向

**目标**：产品化、多租户、文档与知识库能力、质量与成本优化。

| 序号 | 方向 | 说明 |
|------|------|------|
| P3-1 | 产品化部署 | Docker Compose：FastAPI + PostgreSQL + Redis；会话/上传等存 DB 或 Redis，替代 SQLite + 内存 |
| P3-2 | 文档导出 | 支持需求分析文档导出为 PDF / Word / Confluence 等格式 |
| P3-3 | 多租户支持 | 用户体系（登录/注册）+ 会话按用户隔离，为后续计费/配额打基础 |
| P3-4 | 知识库管理 | 在 RS-Agent 内管理向量库：上传文档、查看索引、触发更新，减少对外部 skill 脚本的依赖 |
| P3-5 | 评测体系 | 对 LLM 输出做自动化评测：质量评分、Mermaid 可渲染率、表格完整率等，支撑迭代与回归 |
| P3-6 | 多模型支持 | 不同阶段选用不同模型（如 query 扩展用 turbo，草稿用 plus/max），平衡成本与质量 |

**建议顺序**：P3-1（部署与存储）→ P3-2、P3-3 → P3-4 / P3-5 / P3-6 按业务优先级排期。

---

## 五、甘特式视图（示意）

```
Phase 1 (P0)     [P0-1✓] → [P0-2✓] → [P0-3✓] → [P0-4✓]  ← 全部完成
                     ↘______↗

Phase 2 (P1)     [P1-4][P1-5][P1-3]   [P1-1][P1-2]   [P1-6]
                 (依赖P0-2)  (可并行)              (依赖P0-2)

Phase 3         [P3-1] → [P3-2][P3-3] → [P3-4] / [P3-5] / [P3-6]
```

---

## 六、版本与文档建议

- **Phase 1 已完成**：P0-1/P0-2（v0.2.0）、P0-3/P0-4（v0.3.0），Phase 1 结束。
- **Phase 2 完成**：可定为 **0.3.0**（体验与可维护性增强）。
- **Phase 3**：按功能分批发布，每批一个 MINOR（如 0.4.0、0.5.0）。
- 每个 P0/P1/P3 任务在 CHANGELOG 中单独列条，便于回溯和评审。

---

## 维护说明（更新本文件）

- **何时删除**：当某项任务已完成并**在 CHANGELOG 中发版**后，从本文件中**删除该条**，避免与已完成工作重复。
- **如何对应**：在 CHANGELOG 当条中可注明「（对应 Roadmap P0-1）」等，便于核对；删除本文件中的 P0-1 行即可。
- **可选自动化**：后续可增加脚本（如 `scripts/sync_roadmap_from_changelog.py`），根据 CHANGELOG 中「对应 Roadmap Pxx」的标记，自动从本文件移除已完成项；当前以**手动维护**为主。
